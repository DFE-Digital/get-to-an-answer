@page "/admin/questionnaires/{questionnaireId:guid}/track"
@model Admin.Pages.Questionnaire.TrackQuestionnaires
@using AngleSharp.Common
@using Common.Enum
@using Common.Models
@using Microsoft.AspNetCore.Html

@{
  ViewData["Title"] = "Home Page";
  var questionnaireViewModel = Model.ViewModel;
  var questionnaire = Model.Questionnaire;
  
  IHtmlContent TaskStatusTag(CompletableTask task, CompletionStatus defStatus = CompletionStatus.NotStarted ) => 
    Html.Raw(Model.Questionnaire?.CompletionTrackingMap?.GetOrDefault(task, defStatus) switch
  {
    CompletionStatus.NotStarted => 
      "<strong class=\"govuk-tag govuk-tag--blue\">Not started</strong>",
    CompletionStatus.InProgress => 
      "<strong class=\"govuk-tag govuk-tag--light-blue\">In progress</strong>",
    CompletionStatus.Completed => "Completed",
    _ => "<strong class=\"govuk-tag govuk-tag--blue\">Not started</strong>"
  });
}

@section BeforeContent
{
  <a class="govuk-back-link govuk-!-display-none-print" href="/admin/questionnaires/manage">Back to questionnaires</a>
}

@if (questionnaireViewModel.QuestionnaireState is { InviteAccepted: true })
{
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <div class="govuk-notification-banner govuk-notification-banner--success" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
        <div class="govuk-notification-banner__header">
          <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
            Success
          </h2>
        </div>
        <div class="govuk-notification-banner__content">
          <h3 class="govuk-notification-banner__heading">
            You've been added as a contributor.
          </h3>
          <p class="govuk-body">We are glad to have you on the team.</p>
        </div>
      </div>
    </div>
  </div>
} 
else if (questionnaireViewModel.QuestionnaireState is { JustCreated: true })
{
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <div class="govuk-notification-banner govuk-notification-banner--success" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
        <div class="govuk-notification-banner__header">
          <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
            Success
          </h2>
        </div>
        <div class="govuk-notification-banner__content">
          <h3 class="govuk-notification-banner__heading">
            Your questionnaire has been created.
          </h3>
        </div>
      </div>
    </div>
  </div>
}
else if (questionnaireViewModel.QuestionnaireState is { JustUpdated: true })
{
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <div class="govuk-notification-banner govuk-notification-banner--success" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
        <div class="govuk-notification-banner__header">
          <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
            Success
          </h2>
        </div>
        <div class="govuk-notification-banner__content">
          <h3 class="govuk-notification-banner__heading">
            Your changes have been saved.
          </h3>
        </div>
      </div>
    </div>
  </div>
}
else if (questionnaireViewModel.QuestionnaireState is { JustCloned: true })
{
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <div class="govuk-notification-banner govuk-notification-banner--success" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
      <div class="govuk-notification-banner__header">
        <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
          Success
        </h2>
      </div>
      <div class="govuk-notification-banner__content">
        <h3 class="govuk-notification-banner__heading">
          Your clone questionnaire has been created.
        </h3>
      </div>
    </div>
  </div>
</div>
}
else if (questionnaireViewModel.QuestionnaireState is { JustPublished: true })
{
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <div class="govuk-notification-banner govuk-notification-banner--success" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
        <div class="govuk-notification-banner__header">
          <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
            Success
          </h2>
        </div>
        <div class="govuk-notification-banner__content">
          <h3 class="govuk-notification-banner__heading">
            Your questionnaire has been published.
          </h3>
        </div>
      </div>
    </div>
  </div>
}
else if (questionnaireViewModel.QuestionnaireState is { JustUnpublished: true })
{
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <div class="govuk-notification-banner govuk-notification-banner--success" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
        <div class="govuk-notification-banner__header">
          <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
            Success
          </h2>
        </div>
        <div class="govuk-notification-banner__content">
          <h3 class="govuk-notification-banner__heading">
            Your questionnaire has been unpublished.
          </h3>
        </div>
      </div>
    </div>
  </div>
}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l govuk-!-margin-bottom-2">
      <span class="govuk-caption-l">@Model.Questionnaire?.Title</span><span class="govuk-visually-hidden"> - </span>
      Create and edit your questionnaire
    </h1>
    <dl class="govuk-!-margin-bottom-7">
      <dt class="govuk-visually-hidden">Status</dt>
      <dd class="govuk-!-margin-0"><strong class="govuk-tag" data-status="@questionnaire?.Status">@questionnaire?.Status</strong>
      </dd>
    </dl>
    <div class="app-task-list">
      <h2 class="govuk-heading-m">
        Edit your questionnaire
      </h2>
      <ul class="govuk-task-list">
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint"><a class="govuk-link govuk-task-list__link" aria-describedby="edit-your-questionnaire-name-status" href="/admin/questionnaires/@questionnaire?.Id/edit-name">Edit the name of your questionnaire</a></div>
          <div class="govuk-task-list__status" id="edit-your-questionnaire-name-status">@TaskStatusTag(CompletableTask.EditQuestionnaireName)</div>
        </li>
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link govuk-task-list__link" aria-describedby="optional-task-1-status" href="/admin/questionnaires/@questionnaire?.Id/start-page/edit">
              Add and edit start page
            </a>
          </div>
          <div class="govuk-task-list__status" id="optional-task-1-status">
            <strong class="govuk-tag govuk-tag--grey">Optional</strong>
          </div>
        </li>
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint"><a class="govuk-link govuk-task-list__link" aria-describedby="create-your-questionnaire-2-status" href="@string.Format(Routes.AddAndEditQuestionsAndAnswers, Model.QuestionnaireId)">Add and edit questions and answers</a></div>
          <div class="govuk-task-list__status" id="create-your-questionnaire-2-status">@TaskStatusTag(CompletableTask.AddQuestionsAndAnswers)</div>
        </li>
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link govuk-task-list__link" aria-describedby="create-your-questionnaire-1-status" 
               href="/admin/questionnaires/@questionnaire?.Id/contents">Add and edit end results</a>
          </div>
          <div class="govuk-task-list__status" id="create-your-questionnaire-1-status">
            <strong class="govuk-tag govuk-tag--grey">Optional</strong>
          </div>
        </li>
      </ul>
      <h3 class="govuk-heading-s">Customise look and feel</h3>
      <ul class="govuk-task-list">
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link govuk-task-list__link" aria-describedby="create-your-questionnaire-1-status" href="/admin/questionnaires/@questionnaire?.Id/look-and-feel">Edit look and feel of your questionnaire</a>
          </div>
          <div class="govuk-task-list__status" id="create-your-questionnaire-1-status"><strong class="govuk-tag govuk-tag--grey">Optional</strong></div>
        </li>
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link govuk-task-list__link" aria-describedby="create-your-questionnaire-1-status" href="/admin/questionnaires/@questionnaire?.Id/edit-continue-button">Edit text on 'continue' buttons</a>
          </div>
          <div class="govuk-task-list__status" id="create-your-questionnaire-1-status"><strong class="govuk-tag govuk-tag--grey">Optional</strong></div>
        </li>
      </ul>
      <h3 class="govuk-heading-s">Add contact details</h3>
      <ul class="govuk-task-list">
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link govuk-task-list__link" aria-describedby="provide-privacy-and-contact-details-2-status" href="/forms/262709/contact-details">Provide contact details for support</a>
          </div>
          <div class="govuk-task-list__status" id="provide-privacy-and-contact-details-2-status">
            <strong class="govuk-tag govuk-tag--grey">Optional</strong>
          </div>
        </li>
      </ul>
      <h2 class="govuk-heading-m">
        Check and review
      </h2>
      <ul class="govuk-task-list">
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link govuk-task-list__link" href="/admin/questionnaires/@questionnaire?.Id/start-preview" 
               target="_blank">Preview this questionnaire (opens in new tab)</a>
          </div>
        </li>
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link" href="/admin/questionnaires/@questionnaire?.Id/branching-map" target="_blank" 
               rel="noopener">View branching map (opens in new tab)</a>
          </div>
        </li>
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link" href="/admin/questionnaires/@questionnaire?.Id/version-history">View questionnaire versions</a>
          </div>
        </li>
      </ul>
      <h2 class="govuk-heading-m">
        Manage questionnaire
      </h2>
      <ul class="govuk-task-list">
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link govuk-task-list__link" aria-describedby="optional-task-1-status" href="/admin/questionnaires/@questionnaire?.Id/contributors">
              View and change who has access
            </a>
          </div>
        </li>
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link" href="/admin/questionnaires/@questionnaire?.Id/clone">Clone this questionnaire</a>
          </div>
        </li>
      </ul>
      <h2 class="govuk-heading-m">
        Set up questionnaire on your service
      </h2>
      <ul class="govuk-task-list">
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link govuk-task-list__link" aria-describedby="edit-slug-status" href="/admin/questionnaires/@questionnaire?.Id/edit-slug">Edit the slug of your questionnaire</a>
          </div>
          <div class="govuk-task-list__status" id="edit-slug-status">@TaskStatusTag(CompletableTask.EditQuestionnaireSlug)</div>
        </li>
        <li class="govuk-task-list__item govuk-task-list__item--with-link">
          <div class="govuk-task-list__name-and-hint">
            <a class="govuk-link" href="/admin/questionnaires/@questionnaire?.Id/deployment" target="_blank">Set up questionnaire on your service</a>
          </div>
        </li>
      </ul>
    </div>
    <div class="govuk-button-group">
      @if (questionnaire?.Status is EntityStatus.Draft or EntityStatus.Private)
      {
        <a class="govuk-button govuk-button--primary" data-module="govuk-button" href="/admin/questionnaires/@questionnaire?.Id/publish-confirmation" data-govuk-button-init="">Publish questionnaire</a>
      } 
      else if (questionnaire?.Status == EntityStatus.Published)
      {
        <a class="govuk-button govuk-button--secondary" data-module="govuk-button" href="/admin/questionnaires/@questionnaire?.Id/unpublish-confirmation" data-govuk-button-init="">Unpublish questionnaire</a>
      }
      <a class="govuk-button govuk-button--warning" data-module="govuk-button" href="/admin/questionnaires/@questionnaire?.Id/delete/confirm" data-govuk-button-init="">Delete questionnaire</a>
    </div>
  </div>
</div>
