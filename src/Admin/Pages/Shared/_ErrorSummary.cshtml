@functions{
    string BuildInputId(string fieldName)
    {
        var fullName = ViewData.TemplateInfo.GetFullHtmlFieldName(fieldName);
        return fullName
            .Replace("[", "-", StringComparison.Ordinal)
            .Replace("]", "", StringComparison.Ordinal)
            .Replace(".", "-", StringComparison.Ordinal);
    }
}

@if (ViewData.ModelState.Any(ms => ms.Value?.Errors.Count > 0))
{
    <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert">
        <h2 id="error-summary-title" class="govuk-error-summary__title">There is a problem</h2>
        <div class="govuk-error-summary__body">
            <ul class="govuk-list govuk-error-summary__list">
                @foreach (var entry in ViewData.ModelState.Where(ms => ms.Value?.Errors.Count > 0))
                {
                    var fieldId = BuildInputId(entry.Key);
                    var message = entry.Value?.Errors.First().ErrorMessage;
                    <li>
                        <a class="govuk-link govuk-error-summary__link" href="#@fieldId">
                            @message
                        </a>
                    </li>
                }
            </ul>
        </div>
    </div>
}